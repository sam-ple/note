## ✅ Rubyのバージョン別「要注意」変更点まとめ

| バージョン             | 主な変更点                        | 互換性への影響度          |
| ----------------- | ---------------------------- | ----------------- |
| **1.8 → 1.9**     | エンコーディング処理の大幅変更、enumerator導入 | 🔥 破壊的変更あり（特に文字列） |
| **1.9 → 2.0〜2.3** | 新しい構文・メソッド追加、古い記法の非推奨        | ⚠ 部分的非互換          |
| **2.5〜2.7**       | パターンマッチ（試験的）、`then`追加        | ✅ 互換性ありつつ機能追加     |
| **3.0〜3.2**       | 引数の処理が大きく変更、非推奨多数削除          | ❌ 非互換多し（注意）       |

---

## 🔥 破壊的変更があった主な例

### 🔁 1.8 → 1.9 の重大変更

* **文字列の扱いがバイナリ→エンコーディング付きへ**

  ```ruby
  # Ruby 1.8では ASCII/BINARY のみ
  # Ruby 1.9以降では Encoding（UTF-8, Shift_JISなど）が明示される
  "あ".encoding  # => UTF-8
  ```

* **Enumerable/Enumerator の仕様変更**

  * `each` などで `Enumerator` が返るように

---

### 🧩 2.x 系での注意点（非推奨〜削除）

#### 1. `Fixnum` / `Bignum` の統合（Ruby 2.4）

```ruby
# Ruby 2.3以前
123.class     # => Fixnum
123456789012345.class  # => Bignum

# Ruby 2.4以降
123.class     # => Integer（統一された）
```

#### 2. `Kernel#taint`, `untaint`（Ruby 2.7で非推奨 → Ruby 3.2で削除）

* 古いセキュリティモデルに基づいたが、今は非推奨 → 削除

---

### 🧪 Ruby 2.7〜：試験的パターンマッチ導入（→ Ruby 3系で正式化）

```ruby
case {x: 1, y: 2}
in {x: 1, y: 2}
  puts "Matched!"
end
```

* Ruby 2.7：試験的機能（警告あり）
* Ruby 3.0〜：正式サポート（警告なし）

---

### 🛑 Ruby 3.0 での大きな非互換（特に注意！）

#### 1. 引数の仕様変更（`...` や キーワード引数）

```ruby
def foo(x: 1); end

# Ruby 2.x → OK
foo({x: 1})  # Ruby 3.0ではエラー
```

* **Ruby 3.0ではキーワード引数が厳格になり、Hash渡しではダメ**
* 互換性維持には `ruby2_keywords` や `...` を使う工夫が必要

#### 2. `$SAFE` 変数の削除（セキュリティレベル管理）

* `$SAFE` はセキュリティ管理に使われていたが、Ruby 3.0で完全削除

---

### ✅ Ruby 3.1〜3.2 での進化・削除例

* `Data.define` の追加（軽量データクラス）
* `flip-flop演算子`（`if (1..3)` など）の削除（3.2で消滅）
* `libyaml` のアップデートにより YAML の仕様変更（`Psych`）

---

## 📌 よく使うけど削除・非推奨されたもの（抜粋）

| 削除・非推奨                       | 代替                 |
| ---------------------------- | ------------------ |
| `Fixnum`, `Bignum`           | `Integer`          |
| `$SAFE`                      | セキュリティ制御は別途（Gemなど） |
| `taint`, `untaint`           | 使用不要               |
| `flip-flop演算子` (`if (1..5)`) | 条件分岐で明示的に書く        |

---

## ✅ バージョンごとの注意点まとめ

| バージョン | 気をつける点                        |
| ----- | ----------------------------- |
| 1.9   | エンコーディング、enumeratorの導入        |
| 2.4   | Fixnum/Bignum 廃止 → Integerに統合 |
| 2.7   | パターンマッチ試験導入、引数まわりの警告強化        |
| 3.0   | 引数の厳格化、非推奨機能の一斉削除（`$SAFE`など）  |
| 3.2   | `flip-flop演算子` 削除、セキュリティ機能の刷新 |

---

## 🛠 補足：使っているRubyのバージョンを確認するには

```bash
ruby -v
```

---

## 🎯 まとめ

Rubyも Python と同様に、「**書けるけど通らないコード**」「**前のバージョンなら動いたのに**」というケースがバージョン違いでよく起こります。
特に **Ruby 3系** は引数・非推奨削除の影響が大きいので、**バージョンを揃える** or **バージョン条件分岐を書く**のがポイントです。

